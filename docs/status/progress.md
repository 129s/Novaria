# Novaria Progress

## status

- 项目当前按负责人决策从 M6 回退至 M2，按新 gameplay 蓝图重建可玩闭环。
- 已完成对 `docs/gameplay/blueprint.md` 与 `docs/gameplay/data-dictionary.md` 的全量对齐检查，现有实现与蓝图仍有明显缺口。
- 二次核查确认输入模型仍残留 `W/S/方向键` 纵向移动逻辑，与蓝图 `A/D + Space` 不一致，已追加为 P0 缺口。
- 三次核查完成：蓝图条目已全部映射到“已实现能力”或 `issues 14-30`，当前不存在未入账设计项。
- 架构核查结论：当前玩法链路仍偏“控制器直写逻辑”，需补齐 EnTT 与 Lua 在玩法层的实际参与，并建立 issue 级 E2E 回归。
- 当前开发主轴：将 M2 收口为“做完即能玩”的一揽子问题单，而不是局部打补丁。
- M2 可玩化批次定义为 `issues 14-30`：代码完成并通过自动化后，再进入负责人体验验收。
- `issues 14-16` 判定为“首版落地但未达蓝图完成态”，统一回到返工队列。
- 发布闸门以自动化测试、日志证据与负责人人工验收共同判定。

## milestones

> 里程碑仅表达宏观阶段目标，不描述技术实现细节。

| 编号 | 阶段 | 完成状态 | 阶段目标 | 退出标准 |
| --- | --- | --- | --- | --- |
| M1 | 基础启动 | 已完成 | 建立可持续开发基础与统一协作节奏。 | 团队可稳定构建、运行、验证。 |
| M2 | 可玩闭环（重开） | 进行中 | 形成“采集-建造-制作木剑-昼夜生存”的最小可玩路径。 | 主流程可独立完成，且关键体验项经负责人人工确认通过。 |
| M3 | 协作稳定 | 已冻结 | 建立多人协作的稳定性与恢复能力。 | M2 重开验收完成后再恢复推进。 |
| M4 | 扩展生态 | 已冻结 | 建立可控的模组扩展入口与兼容规则。 | M2 重开验收完成后再恢复推进。 |
| M5 | 发布准备 | 已冻结 | 形成可复现的发布与诊断流程。 | M2 重开验收完成后再恢复推进。 |
| M6 | 下一阶段提升 | 已冻结 | 收口权威一致性并提升交互与运行质量。 | M2 重开验收完成后再恢复推进。 |

## issues

> 规则：凡验收涉及视觉、交互、操作手感或其他人类主观体验，必须由项目负责人确认后才能标记“已完成”。

| 序号 | 优先级 | 完成状态 | 关联里程碑 | 具体内容 |
| --- | --- | --- | --- | --- |
| 9 | P0 | 已完成 | M2 | 移除兼容调试输入链路，仅保留正式玩家输入。 |
| 10 | P0 | 已完成 | M2 | 已补齐最小地形生成：单种子可复现地表起伏、树与静态水体（不做流体模拟），并补充自动化校验。 |
| 11 | P0 | 待确认 | M2 | 已实现视觉时序：昼夜循环、背景随时段变化、简化光照（太阳光+遮挡衰减），待人工体验确认。 |
| 12 | P0 | 待确认 | M2 | 已接入木剑闭环：砍树拿木材、制作工作台、制作木剑，待人工体验确认。 |
| 13 | P1 | 待确认 | M2 | M2 人工体验验收：可读性、交互手感、流程可达性与稳定性。 |
| 14 | P0 | 待确认 | M2 | 已完成输入通道闭环：左键持续 Action、右键瞬时 Interaction、`1-0/滚轮` 槽位切换、按键去抖与单次触发边界，待负责人体验确认。 |
| 15 | P0 | 待确认 | M2 | 已完成 2D 目标解析与可达判定：基于光标定位目标格，统一 `reach=4` 欧氏距离校验，Action/Interaction 共用，待负责人体验确认。 |
| 16 | P0 | 待返工 | M2 | ActionBundle 运行时：`Swing+Harvest` 与 `PlaceBlock` 双路径、工具门槛、放置仅 `air`、放置耗时 `0.12s`、动画与进度解耦。 |
| 17 | P0 | 待返工 | M2 | 掉落与拾取事件链：采集产出 `WorldDrop`、接触拾取入包、拾取文本/音效/计数副作用齐全。 |
| 18 | P0 | 待实现 | M2 | 背包与热栏数据模型：多行网格、热栏行绑定、`Tab` 循环切行、行槽状态可持久。 |
| 19 | P0 | 待实现 | M2 | `Esc` 背包/制作入口：打开背包即展示制作区，彻底移除 Q/F 直连制作路径。 |
| 20 | P0 | 待实现 | M2 | 无形状配方系统：支持 `workbench / wood_sword / torch`，并实现工作台可达前置。 |
| 21 | P0 | 待实现 | M2 | 开局载荷与物品语义：初始发放 `镐+斧`，统一工具/方块/武器分类及热栏使用规则。 |
| 22 | P0 | 待实现 | M2 | 煤矿落地：世界生成 `coal_ore`，采集产出 `coal`，资源统计进入 HUD。 |
| 23 | P0 | 待实现 | M2 | 火把闭环：火把配方、放置消耗、不可放水体、火把物品与方块状态同步。 |
| 24 | P0 | 待实现 | M2 | 光照收口：太阳列衰减与火把点光叠加，亮度封顶，昼夜与局部光照共同生效。 |
| 25 | P1 | 待实现 | M2 | 右键交互抽象：`InteractionType` 与优先级（目标交互对象 > 手持右键效果 > 无动作）最小可用落地。 |
| 26 | P1 | 待实现 | M2 | 智能选择 UX：`Ctrl` 切模式，`Shift` 目标高亮+`context_slot` 临时切换并可恢复。 |
| 27 | P1 | 待实现 | M2 | HUD 契约补齐：生命、热栏行槽、`wood/stone/coal/torch`、智能模式与上下文槽状态可见。 |
| 28 | P1 | 待实现 | M2 | 自动化测试补齐：ActionBundle、可达判定、配方门槛、掉落拾取、火把规则与回归用例。 |
| 29 | P0 | 待确认 | M2 | M2 可玩闭环负责人验收：采集-建造-制作木剑-制作并放置火把-昼夜生存全链路通过。 |
| 30 | P0 | 待确认 | M2 | 已完成玩家运动模型重构：移除 `W/S/方向键上下` 位移，改为 `A/D` 水平移动 + `Space` 跳跃 + 重力下落，待负责人体验确认。 |
| 31 | P0 | 待实现 | M2 | EnTT 玩法接入：ActionBundle 结果写入 ECS 命令缓冲并由系统执行，减少 `PlayerController` 直写世界与资源状态。 |
| 32 | P1 | 待实现 | M2 | Lua 玩法接入：将 Interaction 与掉落副作用暴露为脚本事件/回调，至少支持可观测日志与可配置行为分支。 |
| 33 | P0 | 待实现 | M2 | Issue 级 E2E 测试：新增面向 `issues 14-30` 的黑盒流程测试（输入->动作->资源->配方->光照），用于验收前自动回归。 |
