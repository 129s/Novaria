# Novaria MVP 规划（Windows / C++ / SDL3 / LuaJIT）

## 1. 目标与边界

### 1.1 项目目标

Novaria 的 MVP 目标是验证三条闭环，而不是追求内容体量：

- 可玩闭环：采集 → 建造 → 战斗 → 成长。
- 技术闭环：稳定帧率、可维护架构、可持续迭代。
- 扩展闭环：联机与 Mod 在同一套架构下稳定共存。

### 1.2 平台与技术选型

- 目标平台：Windows（MVP 阶段仅此平台）。
- 语言：C++。
- 底层框架：SDL3。
- 脚本层：LuaJIT。

### 1.3 MVP 完成定义（Definition of Done）

满足以下全部条件，判定 MVP 完成：

1. 完整流程可达成：新建世界后可完成采集、建造、战斗、击败小 Boss、存档回读。
2. 性能达标：1080p 场景下客户端 60 FPS，P95 帧时间 ≤ 16.6ms。
3. 联机可用：4 人协作连续 30 分钟无致命崩溃，关键状态无持续错乱。
4. 扩展可用：第三方 Mod 可新增 `item`、`recipe`、`npc` 行为并通过联机一致性校验。

## 2. 范围定义

### 2.1 MVP 必做

- 世界：有限大地图、1 个地表生物群系、1 个地下层、昼夜循环。
- 基础玩法：方块挖掘/放置、背包、工作台、配方合成、基础装备成长。
- 战斗内容：3 类基础敌人 + 1 个小 Boss（含掉落与基础 AI）。
- 联机模式：房主兼服（Host-Authoritative），支持直连/IP 与基础聊天。
- 存档系统：世界与角色存档、基础版本字段与兼容入口。
- Mod v0：支持新增 `item/recipe/npc` 行为脚本。

### 2.2 MVP 不做

- PVP、匹配大厅、跨平台联机。
- 大型剧情任务线与复杂世界事件系统。
- 严格 Mod 权限沙箱（先采用本地信任模型）。
- 脚本层改写底层渲染或网络协议。

## 3. 核心架构决策

1. 网络模型：`Server Authoritative`（先房主兼服，协议可迁移专用服）。
2. 模拟与渲染：固定 Tick（建议 60Hz）+ 渲染插值。
3. 世界组织：Chunk 化管理、脏区追踪、增量同步。
4. 脚本定位：LuaJIT 仅承载内容与规则扩展，不承载高频底层循环。
5. 数据策略：内容数据驱动优先，减少硬编码分支膨胀。

## 4. 代码结构

```text
src/
  app/
  platform/
  sim/
  world/
  net/
  script/
  mod/
  save/
  ui/
assets/
  base_content/
mods/
  _example_core/
tools/
  content_validator/
tests/
  sim/
  net/
docs/
```

模块职责：

- `app`：启动流程、生命周期、依赖装配。
- `platform`：SDL3 资源（窗口、输入、音频、时间、文件系统）。
- `sim`：纯游戏规则与状态推进（不依赖 SDL3）。
- `world`：地图生成、Chunk 生命周期、地块操作。
- `net`：连接、消息、命令流、快照与增量复制。
- `script`：LuaJIT VM 管理、绑定、事件桥接、故障隔离。
- `mod`：清单、依赖、装载顺序、联机一致性校验。
- `save`：存档读写、版本字段、迁移入口。
- `ui`：HUD、背包、合成、聊天、调试界面。

## 5. 里程碑（14 周）

### W1-W2：工程骨架

- CMake、配置、日志、主循环、输入映射。
- 验收：空工程稳定运行并输出基础诊断日志。

### W3-W6：单机闭环

- Chunk 生成与持久化。
- 挖掘/放置/碰撞。
- 背包/配方/工作台。
- 敌人 AI、战斗、掉落、小 Boss。
- 验收：单机完整闭环可通关并可回读存档。

### W7-W10：联机闭环

- 连接管理、心跳、命令同步。
- 世界与实体复制。
- 断线重连与状态恢复。
- 验收：4 人协作连续 30 分钟通过。

### W11-W12：Mod v0

- LuaJIT 绑定与脚本事件模型。
- Mod 装载器、依赖顺序、示例 Mod。
- 联机一致性指纹（manifest + hash）。
- 验收：第三方 Mod 在联机中可稳定运行。

### W13-W14：性能与发布准备

- 性能剖析与热点优化。
- 稳定性回归与打包流程。
- 验收：达成性能目标并产出 MVP 构建。

## 6. 工程纪律（强制）

1. `sim` 层禁止依赖 SDL3。
2. 客户端只发命令，不直接改写世界真值。
3. 每周产出可演示构建，不接受“仅代码堆积”。
4. 新系统必须附最小验收标准与失败回退方案。

## 7. 主要风险与应对

- 联机错乱风险：先保命令一致性，再扩状态复制面。
- 脚本失控风险：限定脚本职责，加入异常隔离与超时策略。
- 性能退化风险：每周固定剖析，按热点驱动优化。
- 范围膨胀风险：MVP 范围冻结，新增需求统一排入后续版本。

## 8. MVP 后续方向

- 独立专用服务器。
- 更严格的 Mod 安全与权限模型。
- 多生物群系与更复杂生态系统。
- 内容编辑器与自动化回归工具链。
