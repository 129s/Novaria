# Novaria Gameplay Blueprint

## 1. 设计目标

- 提供 2D 沙盒生存玩法，形成“采集、建造、制作、照明、生存”闭环。
- 交互语义采用“左键持续 Action、右键瞬时 Interaction”的双通道模型。
- 左键执行 `ActionBundle`，允许由多个原子 Action 组合表达玩法行为。
- 背包与制作采用 MC/星露谷语义，保留泰拉风格的智能辅助 UX。

## 2. 核心循环

- **短循环（秒级）**：锁定目标 -> 按住 Action 或触发 Interaction -> 获得反馈。
- **中循环（分钟级）**：砍树与采矿 -> 制作火把与武器 -> 扩展探索半径。
- **长循环（时段级）**：昼夜交替下维持光照、资源、安全区与战斗能力。

## 3. 输入与控制模型

- `A/D`：水平移动。
- `Space`：跳跃。
- 鼠标左键（按住）：`Action`（持续）。
- 鼠标右键（按下）：`Interaction`（瞬时）。
- 滚轮或 `1-0`：切换当前热栏槽位。
- `Esc`：打开/关闭背包与制作界面。
- `Tab`：切换热栏行（热栏是背包的一行，循环切换）。
- `Ctrl`：智能选择模式开关（toggle）。
- `Shift`（按住）：目标高亮与上下文快捷槽临时扩展。

## 4. Action 与 Interaction 抽象

- **Action（原子行为）**：最小可执行动作单元，例如 `Swing`、`Harvest`、`PlaceBlock`、`ProjectileFire`。
- **ActionBundle（左键执行单元）**：一组可组合 Action，由左键持续驱动按 tick 执行。
- **Interaction（瞬时）**：按下触发一次；用于开箱、开门、对话、使用站点、献祭等瞬时交互。
- 右键 `Interaction` **不处理方块放置**，放置属于左键 `Action` 的持续施作范畴。

## 5. 目标解析与可达判定

- 目标解析基于 2D 光标映射，不使用 3D 准星与射线投射语义。
- 可达判定统一由 `reach_distance` 控制，默认半径 `4` 格。
- 判定依据为“玩家位置到目标格中心的欧氏距离”。
- Action 与 Interaction 在执行前都必须通过可达性校验。

## 6. 左键 ActionBundle 规则（采集/放置分离）

### 6.1 ActionBundle 语义

- 左键按住期间持续构建并执行当前 `ActionBundle`。
- 当前阶段仅启用两类主路径：
  - 采集路径：`Swing + Harvest`
  - 放置路径：`PlaceBlock`
- 当前阶段不引入额外方块替换抽象。

### 6.2 执行流程

- 目标解析 -> 可达判定 -> ActionBundle 组装 -> 能力校验 -> 累积进度 -> 提交 Action 结果。
- 采集提交后生成世界掉落实体与反馈事件（见第 11 节）。

### 6.3 工具与物品硬约束

- Action 必须有对应物品能力，不提供“空手万能动作”。
- 采矿必须使用镐；砍树必须使用斧。
- 镐与斧都属于可挥舞工具：挥舞表现与采集进度同步进行。
- 放置必须手持对应可放置物品，且仅允许放置到 `air` 格。
- 放置同样是持续 Action，存在显式耗时。
- 初始角色默认发放最低级 `镐 + 斧`，避免开局软锁。

### 6.4 耗时规则

- 放置基础耗时固定为 `0.12s/格`。
- 采集耗时由“材质硬度 × 工具效率”决定。
- 挥舞动画与进度计算解耦，防止渲染帧率改变采集效率。

## 7. 右键 Interaction 规则

- 右键只触发瞬时交互，不承担采集或放置。
- 交互类型统一抽象为：`OpenContainer`、`OpenCrafting`、`UseStation`、`OfferItem`、`ActivateObject`、`TalkNpc`。
- 交互优先级为：`目标交互对象` > `手持物右键效果` > `无动作`。

## 8. 背包、热栏与制作

- 背包采用多行网格，热栏是背包某一行。
- `Tab` 切换到下一行热栏，循环切换，不改变物品在背包中的原位置。
- `Esc` 打开背包时同步显示制作区域。
- 配方为无形状配方（shapeless）。
- 制作站配方受可达判定约束：仅当可达工作台时显示对应配方。

## 9. 智能选择与上下文 UX

- `Ctrl`：切换智能选择模式，系统根据目标与场景建议工具/物品。
- `Shift`（按住）：高亮目标并临时展开 `context_slot`。
- `context_slot` 用于快速装填当前交互最优物品，释放 `Shift` 后恢复原热栏选择。
- 典型场景：快插火把、快速采矿、快速砍树、快速献祭物品。

## 10. 世界、资源与光照

- 世界按 chunk 生成并可复现，包含地表层、树木、静态水体与地下煤矿。
- 昼夜周期驱动环境光；太阳光使用列衰减模型。
- 火把提供局部点光，默认半径 `6` 格，可与太阳光叠加并受亮度上限约束。
- 火把不可放置在水体格；水体当前不触发熄灭逻辑。
- 资源链路包含 `wood / stone / coal`，并支撑工作台、木剑、火把配方闭环。

## 11. 掉落与拾取反馈

- 采集 Action 提交后生成 `WorldDrop` 实体，不直接写入背包。
- 玩家接触掉落实体触发 `PickupEvent`，再由事件驱动背包增量。
- `PickupEvent` 必须支持副作用：拾取文本、音效、任务/统计计数等。

## 12. HUD 与反馈要求

- HUD 必须显示：生命、热栏行与槽位、核心资源数量、木剑状态、火把数量、智能模式状态。
- `Shift` 按住态必须有明确目标高亮与上下文槽提示。
- 昼夜与局部光照变化必须在前景与背景层同时可见。

## 13. 非目标

- 流体动力学与水体连通更新。
- 复杂洞穴生态与多生物群系。
- 多阶段 Boss 机制。
- 联机同步与匹配系统。
